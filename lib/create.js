module.exports = accessor

function accessor(key, change) {
  var part = build_part.call(this, key, finish.bind(this))
    , context

  return call

  function call(val, ctx) {
    part(val, context = ctx || val)
  }

  function finish(val, ctx) {
    change.call(this, val, arguments.length > 1 ? ctx : context)
  }
}

function build_part(part, change) {
  var accessor

  for(var i = 0, l = this.types.length; i < l; ++i) {
    if(accessor = this.types[i].call(this, part, change)) {
      return accessor
    }
  }
}
